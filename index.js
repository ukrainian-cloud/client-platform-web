var j=Object.defineProperty;var F=(e,t)=>{for(var r in t)j(e,r,{get:t[r],enumerable:!0})};import"dev-only:preact/debug";import{Component as N,render as H}from"preact";import{jsx as G}from"preact/jsx-runtime";var V=document.head.parentElement,P=V.querySelector(":scope > body"),B=!1,u=class extends N{render(){return this.props.children}static create(t){B||(P.innerHTML="",B=!0,H(G(u,{children:t}),P))}};var I=Object.defineProperty,J=Object.getOwnPropertyDescriptor,y=(e,t,r,n)=>{for(var o=n>1?void 0:n?J(t,r):t,i=e.length-1,a;i>=0;i--)(a=e[i])&&(o=(n?a(t,r,o):a(o))||o);return n&&o&&I(t,r,o),o};function _(e){return(t,r)=>{Object.defineProperty(t,"name",{value:e})}}function p(e,t){return Object.defineProperty(t,"name",{value:e}),t}var g="__uc_globals";globalThis[g]||Object.defineProperty(globalThis,g,{enumerable:!1,configurable:!1,writable:!1,value:Object.create(null)});function x(e,t){let r=globalThis[g];return e in r?r[e]:r[e]=t()}var L=x("utility",()=>Symbol()),m=x("utilityStore",()=>new WeakMap),D=x("utilityState",()=>({isLoaded:!1})),Be=p("isUtility",e=>!!e?.[L]),Le=p("createUtility",(e,t)=>({[L]:!0,implements:e,implementation:t})),De=p("loadUtilities",async(...e)=>{let t=[];for(let r of e){let n=new r.implementation,o=n.init().then(()=>(m.set(r.implements,n),n));t.push(o),m.set(r.implements,o)}await Promise.all(t),D.isLoaded=!0}),C=p("getUtility",e=>Promise.resolve(m.get(e))),Te=p("useUtil",e=>{if(!D.isLoaded)throw new Error("Can't call useUtil hook before utilities fully loaded");return m.get(e)}),f=class{};f=y([_("Initializable")],f);var T=(e=>(e.dark="dark",e.light="light",e))(T||{}),z={Theme:T},c=class extends f{changeListeners={};options={};enums=z;emitChange(e,t){this.changeListeners[e]&&this.changeListeners[e].forEach(r=>{let{once:n}=this.options[e].get(r);n&&(this.changeListeners[e].delete(r),this.options[e].delete(r));try{r(t)}catch(o){console.error(o)}})}onChange(e,t,r){this.changeListeners[e]??=new Set,this.options[e]??=new WeakMap,this.changeListeners[e].add(t),this.options[e].set(t,r||{})}offChange(e,t){this.changeListeners[e]&&(this.changeListeners[e].delete(t),this.options[e].delete(t))}};c=y([_("LocalDB")],c);var d=class extends f{async init(){let e=await C(c);try{await e.get("theme")}catch{await e.set("theme",await this.getDefault())}}};d=y([_("ColorScheme")],d);function $(e,t,...r){return Object.assign(Object.defineProperty(t,"name",{value:e}),...r)}var l=p("Component",$);import{forwardRef as A}from"preact/compat";var h={flexbox:"_flexbox_l45iq_1",row:"_row_l45iq_5","row-reverse":"_row-reverse_l45iq_9",column:"_column_l45iq_13","column-reverse":"_column-reverse_l45iq_17",nowrap:"_nowrap_l45iq_21",wrap:"_wrap_l45iq_25","wrap-reverse":"_wrap-reverse_l45iq_29"};import{jsx as Q}from"preact/jsx-runtime";var O=(o=>(o.row="row",o.rowReverse="rowReverse",o.column="column",o.columnReverse="columnReverse",o))(O||{}),R=(n=>(n.nowrap="nowrap",n.wrap="wrap",n.wrapReverse="wrapReverse",n))(R||{});function X(...e){return e.filter(t=>t).join(" ")}var K=l("FlexBox",A(({children:e,direction:t="row",wrap:r="nowrap"},n)=>Q("div",{class:X(h.flexbox,h[t],h[r]),ref:n,children:e})),{Direction:O,Wrap:R});import{useRef as W,useEffect as Y}from"preact/hooks";import{Fragment as ee,jsx as te}from"preact/jsx-runtime";var Z=l("FlexChild",({children:e,basis:t,grow:r,shrink:n,ref:o})=>{let i=o||W();if(Y(()=>{if(!i?.current)return;let s=i.current;s.style.flexBasis=String(t),s.style.flexGrow=String(r),s.style.flexShrink=String(n)},[i]),typeof e!="object")throw new Error("FlexChild should have exactly 1 DOM element in children. Found the only non-DOM child");let[a]=Array.isArray(e)?e:[e];return a.props.ref=i,te(ee,{children:a})});import{forwardRef as le}from"preact/compat";import{useState as ce,useCallback as pe}from"preact/hooks";import{forwardRef as re}from"preact/compat";var q={spinner:"_spinner_um281_39",rotator:"_rotator_um281_1",path:"_path_um281_43","variant-colorful":"_variant-colorful_um281_49",dash:"_dash_um281_1",colors:"_colors_um281_1","variant-monotone":"_variant-monotone_um281_53"};import{jsx as M}from"preact/jsx-runtime";var{spinner:oe,path:ne,variantColorful:ie,variantMonotone:se}=q,E=(r=>(r[r.monotone=0]="monotone",r[r.colorful=1]="colorful",r))(E||{}),ae={[0]:se,[1]:ie},w=l("Spinner",re(({variant:e=1,class:t,style:r},n)=>M("svg",{class:`${t} ${oe} ${ae[e]}`,width:"100%",height:"100%",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg",style:r,ref:n,children:M("circle",{class:ne,fill:"none","stroke-width":"10","stroke-linecap":"round",cx:"33",cy:"33",r:"30"})})),{Variant:E});var U={button:"_button_1wlm7_1",spinner:"_spinner_1wlm7_18"};import{jsx as de,jsxs as he}from"preact/jsx-runtime";var{button:ue,spinner:me}=U,fe=l("Button",le(({onClick:e,children:t},r)=>{let[n,o]=ce(!1),i=pe(async()=>{o(!0),await e(),o(!1)},[o]);return he("button",{class:ue,onClick:i,disabled:n,ref:r,children:[t,de(w,{variant:w.Variant.monotone,class:me,style:{opacity:n?1:0}})]})}));var k={};F(k,{ClolorSchemeWebImpl:()=>S,LocalDBWebImpl:()=>b});var v="kv",b=class extends c{db;runTransaction(t,r){return new Promise(async(n,o)=>{let a=this.db.transaction(v,t?"readonly":"readwrite").objectStore(v),s=await r(a);s.onerror=()=>{s.onsuccess=null,s.onerror=null,o(s.error)},s.onsuccess=()=>{s.onsuccess=null,s.onerror=null,n(s.result)}})}async init(){await new Promise((t,r)=>{let n="main",o=indexedDB.open(n,1);o.onupgradeneeded=function(){let i=o.result;i.objectStoreNames.contains(v)||i.createObjectStore(v,{keyPath:"key"})},o.onerror=()=>{o.onupgradeneeded=null,o.onerror=null,o.onsuccess=null,r(o.error)},o.onsuccess=()=>{o.onupgradeneeded=null,o.onerror=null,o.onsuccess=null,this.db=o.result,t()}})}async get(t){return await this.runTransaction(!0,r=>r.get(t))}async set(t,r){let n=JSON.parse(JSON.stringify(r));await this.runTransaction(!1,o=>o.put(n,t)),this.emitChange(t,n)}async delete(t){await this.runTransaction(!1,r=>r.delete(t)),this.emitChange(t,void 0)}};var S=class extends d{async getDefault(){let t=await C(c),{Theme:r}=t.enums;return matchMedia("prefers-color-scheme: light").matches?r.light:r.dark}};export{u as App,fe as Button,K as FlexBox,Z as FlexChild,w as Spinner,k as utils};
//# sourceMappingURL=index.js.map